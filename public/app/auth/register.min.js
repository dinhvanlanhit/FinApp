function buttonloading(e, type) {
	if (e != undefined && type != undefined) {
		if (type == true) {
			if (!$(e).children("i").hasClass("loadding")) {
				$(e).attr('disabled', type);
				$(e).prepend('<i  class="loadding spinner-border spinner-border-sm mr-1"></i>');
			}
		} else {
			if ($(e).children("i").hasClass("loadding")) {
				$(e).children("i").remove();
				$(e).attr('disabled', type);
			}
		}
	}
}

function alertRegister(message) {
	var alerthtml = '<div class="alert alert-danger alert-dismissible" role="alert">';
	alerthtml += '' + message + '';
	alerthtml += '<button type="button" class="close" data-dismiss="alert" aria-label="Close">';
	alerthtml += '<span aria-hidden="true">&times;</span>';
	alerthtml += '</button>';
	alerthtml += '</div>'
	return alerthtml;
}

function checkPASS(a, b) {
    var r =false;
	if (a == b) {
		 r = true
	} else {
		 r = false;
    }
    return r;
}
$(document).ready(function () {
	var icon = '<i class="fas fa-exclamation-circle"></i>';
	$.ajaxSetup({
		headers: {
			'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		}
	});
	$("#form-register").on('submit', function (e) {
		e.preventDefault();
	});
	$('#form-register').validate({
		rules: {
			user_type: {
				required: true
			},
			full_name: {
				required: true
			},
			email: {
				required: true
			},
			password: {
				required: true
			},
			confirm_password: {
				required: true
			},
		},
		messages: {
			user_type: {
				required: "Vui lòng chọn lọi người dùng !",
			},
			full_name: {
				required: "Họ và tên không được trống !",
			},
			email: {
				required: "Email không được trống !",
			},
			email: {
				required: "Email không được trống !",
			},
			password: {
				required: "Mật khẩu không được trống !",
			},
			confirm_password: {
				required: "Xác nhận mật khẩu không được trống !",
			},
		},
		errorElement: 'span',
		errorPlacement: function (error, element) {
			error.addClass('invalid-feedback');
			element.closest('.form-group').append(error);
		},
		highlight: function (element, errorClass, validClass) {
			$(element).addClass('is-invalid');
		},
		unhighlight: function (element, errorClass, validClass) {
			$(element).removeClass('is-invalid');
		},
		submitHandler: function (e) {
			buttonloading('#button-register', true);
			var formData = new FormData($("#form-register")[0]);
			if (checkPASS(formData.get('password'), formData.get('confirm_password'))) {
				$.ajax({
					url: routes.register,
					type: 'POST',
					data: formData,
					dataType: 'JSON',
					processData: false,
					contentType: false,
					success: function (data) {
						if (data.statusBoolen) {
							return window.location.href = routes.login;
						} else {
							$("#alert").html(alertRegister(data.messages));
							buttonloading('#button-register', false);
						}
					},
					error: function (error) {
						$("#alert").html(alertRegister('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Emergency notification', 'The server system is having a problem waiting for a moment!'));
						buttonloading('#button-register', false);
					}
				});
			}else{
                $("#alert").html(alertRegister('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Mật khẩu xác nhận không khớp !'));
                buttonloading('#button-register', false);
            }
		}
	});
});